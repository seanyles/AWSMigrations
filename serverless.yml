
service: KMjobs # NOTE: update this with your service name

provider:
  name: aws
  runtime: nodejs8.10
  role: arn:aws:iam::262163321023:role/service-role/lambda_basic_execution

package:
  include:
    - src/**
    - jobhandler.js
  exclude:
    - .gitignore
    - .circleci
    - test

functions:
  create-proofset-job:
    handler: jobhandler.createProofSetJob
    events:
      - s3:
          bucket: kleermailJobs
          event: s3:ObjectCreated:Put
          rules:
            - prefix: uploads/
            - suffix: .csv

resources:
  Resources:
    S3BucketKleermailJobs:
      Type: AWS::S3::Bucket
      Properties:

    Create-proofset-jobLambdaPermissionKleermailJobsS3:
      Type: AWS::Lambda::Permission
      Properties:
        FunctionName:
          "Fn::GetAtt":
          - ResizeLambdaFunction
          - Arn
        Principal: "s3.amazonaws.com"
        Action: "lambda:InvokeFunction"
        SourceAccount:
          Ref: AWS::AccountId
        SourceArn: "arn:aws:s3:::kleermailJobs"

plugins:
  - serverless-offline
